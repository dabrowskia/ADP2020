---
title: 'Sprawdzenie przydatności narzędzia dla inwestora do przewidywania ile kin powinno funkcjonować w danym
  powiecie na podstawie  liczby klubów sportowych, liczby trenerów i liczby osób ćwiczących.
  Wartości współczynników służących predykcji zostały znormalizowane wielkościa populacji w
  danym powiecie i przedstawione liczbą na tysiąc mieszkańców. '
author: "Dariusz Ratajczak i Tomasz Furgalski"
date: "22 06 2020"
output:
  html_document: default
  pdf_document: default
---
Gdyby istniały zależności liniowe między ilością klubów, ilością treneróW, iloscią ćwiczących w klubach a ilością kin w powiecie, raport przedstawi możliwość wykorzystania tych zależnosci, dla przewidywania celowości inwestowania w kina w danym powiecie, dla potencjalnego inwestora.


```{r setup, include=FALSE,echo =FALSE,}
knitr::opts_chunk$set(echo = FALSE)
```
```{r,echo=FALSE,message = FALSE,warning = FALSE,include = FALSE}

library(openxlsx)
library(dplyr)
library(ggplot2)
library(sf)
library(dplyr) 
library(raster) 
library(tidyverse) 
library(spData) 
library(spDataLarge) 
library(tmap)
```

```{r,echo=FALSE,message = FALSE,warning = FALSE,include = FALSE}
setwd("J:/ADP2020/personal/Tomek Furgalski/R")
```
```{r,echo=FALSE,message = FALSE,warning = FALSE,include = FALSE}
# Wczytanie danych i przygotowanie danych

powiaty <- st_read("Powiaty.shp")
powiaty$JPT_KOD_JE <-paste0(powiaty$JPT_KOD_JE, '000')

kina <- read.xlsx('kina_tylko.xlsx')


sport <- read.xlsx('sport_tylko.xlsx')

ludnosc <- read.xlsx('ludnosc_tylko.xlsx')

df1<-ludnosc %>%
  left_join(kina, by = c('Kod' = 'Kod'))

df2 <- df1 %>%
  left_join(sport, by = c('Kod' = 'Kod'))

#przygotowanie danych do obliczeń,normalizowanie klubów, cwiczących i trenerów #przez ludnosc. .

df2 %>%
mutate(kina_ludnosc=(kina/ludnosc)*1000,klub_ludn=(kluby/ludnosc)*1000, trener_ludnosc= (trenerzy/ludnosc)*1000, cwiczacy_ludnosc=(cwiczacy/ludnosc)*1000) ->df3
  View(df3)

df3$Kod <- as.character(df3$Kod)
df4 <- powiaty %>%
 left_join(df3, by = c('JPT_KOD_JE' = 'Kod'))
# df4 jest naszą główną bazą danych
View(df4)

```

```{r,echo=FALSE,message = FALSE,warning = FALSE}
ggplot()+ geom_sf(data = df4, aes(fill = kina_ludnosc)) + scale_fill_gradientn(colors = terrain.colors(20))+ ggtitle("Liczba kin na tysiąc mieszkańców") +
    theme_light()+  labs(fill = "liczba kin na tysiąc mieszkańców")
```

## Predykcja liczby kin na tysiąc mieszkańców na podstawie współczynników

### Wykorzystanie liczby klubów sportowych znormalizowanych populacją w powiecie jako współczynnika regresji

```{r,echo=FALSE,message = FALSE,warning = FALSE}
ggplot()+ geom_sf(data = df4, aes(fill = klub_ludn)) + scale_fill_gradientn(colors = terrain.colors(20))+ ggtitle("Liczba klubów na tysiąc mieszkańców") +
    theme_light()+  labs(fill = "liczba klubów na tysiąc mieszkańców")
```
```{r,echo=FALSE, message = FALSE, warning = FALSE}
ggplot(df4,aes(x= klub_ludn,
             y= kina_ludnosc))+
  geom_point()+
    xlab("Ilość klubów na tysiąc mieszkańców") +
    ylab("Liczba kin w powiecie na tysiąc mieszkańców")+
  
    ggtitle("Wykres zależności liniowej między liczbą klubów a liczba kin") +
    theme_light()+
    geom_smooth(method='lm')

```
```{r,echo=TRUE,message = FALSE, warning = FALSE}
model1.lm <- lm(kina_ludnosc ~ klub_ludn, 
               data = df4, na.rm=TRUE) 
summary(model1.lm)
```
#### Równanie regresji dla obliczania ilości kin na tysiąc mieszkańców na podstawie ilości klubów znormalizowanych populacją w powiecie
$$ y=   0.003179  * ilość \ klubów \ na \ tys. \ mieszkańców + 0.016485 $$


### Wykorzystanie ilości trenerów znormalizowanej populacją w powiecie jako współczynnika regresji

```{r,echo=FALSE,message = FALSE,warning = FALSE}
ggplot()+ geom_sf(data = df4, aes(fill = trener_ludnosc)) + scale_fill_gradientn(colors = terrain.colors(20))+ ggtitle("Liczba trenerów na tysiąc mieszkańców") +
    theme_light()+  labs(fill = "liczba trenerów na tysiąc mieszkańców")

```
```{r,echo=FALSE,message = FALSE,warning = FALSE}
ggplot(df4,aes(x=trener_ludnosc,
               y= kina))+
  geom_point()+
  xlab("Liczba ternerów na tysiąc mieszkańców") +
  ylab("Liczba kin w powiecie na tysiąc mieszkańców")+
  
  ggtitle("Wykres zależności liniowej między liczbą trenerów normalizowaną populacją w powiecie a liczbą kin") +
  theme_light()+
  geom_smooth(method='lm')
  

```

```{r,echo=TRUE,message = FALSE,warning = FALSE}
model2.lm <- lm(kina_ludnosc ~ trener_ludnosc,
               data = df4,na.rm=TRUE) 

summary(model2.lm)
```
#### Równanie regresji dla obliczania ilości kin na podstawie ilości trenerów znormalizowanej wielkościa populacji w danym powiecie
$$ y=   0.03269  * ilość \ trenerow \ na \ tys. \ mieszkańców + 0.015461 $$


### Wykorzystanie ilości ćwiczących w klubach znormalizowanej populacją w powiecie jako współczynnika regresji
```{r,echo=FALSE,message = FALSE,warning = FALSE}
ggplot()+ geom_sf(data = df4, aes(fill = cwiczacy_ludnosc)) + scale_fill_gradientn(colors = terrain.colors(20))+ ggtitle("liczba ćwiczących w klubach w powiecie") +
    theme_light()+  labs(fill = "Liczba ćwiczących na tysiąc mieszkańców")
```




```{r,echo=FALSE,message = FALSE,warning = FALSE}
ggplot(df4,aes(x=cwiczacy_ludnosc,
               y= kina))+
  geom_point()+
  xlab("Ilość ćwiczących w klubach normalizowana populacją w powiatach") +
  ylab("Liczba kin w powiecie na tysiąc mieszkańców")+
  
  ggtitle("Wykres zależności liniowej między liczbą ćwiczących a liczba kin") +
  theme_light()+
  geom_smooth(method='lm')
```
```{r,echo=FALSE,message = FALSE,warning = FALSE}
model3.lm <- lm(kina_ludnosc ~ cwiczacy_ludnosc, 
               data = df4, na.rm=TRUE) 

summary(model3.lm)

```
#### Równanie regresji dla obliczania ilości kin na podstawie ilości ćwiczących w klubach znormalizowanej populacją w powiecie 
$$ y=   0.04505  * ilość \ cwiczących \ na \ tys. \ mieszkańców + 0.0657 $$
```{r,echo=TRUE,message = FALSE,warning = FALSE}
model4.lm <- lm(df4$kina_ludnosc~df4$klub_ludn+df4$trener_ludnosc+df4$cwiczacy_ludnosc,na.rm=TRUE)
summary(model4.lm)
```

### Równnaie regresji wielorakiej dla przewidywania ilosci kin na tysiąc mieszkańców na podstawie trzech współczynników: ilości klubów, ilosci trenerów i ilości ćwiczących. Współczynniki zostały znormalizowane wielkościa populacji w danym powiecie.

$$ y=   0.0032008  * ilość \ klubów \ na\ tys. \ mieszkańców + 0.0062440 * ilosć \ trenerów \ na\ tys. \ mieszkańców - 0.0001507 * ilość \ ćwiczących \ na\ tys. \ mieszkańców +  0.0161031 $$


## Wniski 
### Niestety współczynniki R kwadrat są bardzo niskie, to świadczy o niskim dopasowaniu modeli. Oznacza to, że  autorzy raportu odradzają używania sprawdzanych w raporcie  modeli do predykcji celowości inwestowania w kina.